import{_ as u,r as o,o as i,c as r,b as a,w as t,d as n,e as s,a as c}from"./app-Js4EkCke.js";const k={},d=c(`<h1 id="高级功能" tabindex="-1"><a class="header-anchor" href="#高级功能"><span>高级功能</span></a></h1><h2 id="_1、自定义fetch" tabindex="-1"><a class="header-anchor" href="#_1、自定义fetch"><span>1、自定义fetch</span></a></h2><p>通过自定义fetch替换框架自带的fetch，可以修改fetch配置(添加cookie或header信息等等)，或拦截HTML、JS、CSS等静态资源。</p><p>自定义的fetch必须是一个返回string类型的Promise。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">import</span> microApp <span class="token keyword">from</span> <span class="token string">&#39;@micro-zoe/micro-app&#39;</span>

microApp<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 自定义fetch
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">url</span> 静态资源地址
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>object<span class="token punctuation">}</span></span> <span class="token parameter">options</span> fetch请求配置项
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">}</span></span> <span class="token parameter">appName</span> 应用名称
   * <span class="token keyword">@returns</span> Promise&lt;string&gt;
  */</span>
  <span class="token function">fetch</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> appName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">&#39;http://localhost:3001/error.js&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 删除 http://localhost:3001/error.js 的内容</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// fetch 默认不带cookie，如果需要添加cookie需要配置credentials</span>
      <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;include&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 请求时带上cookie</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container note"><p class="custom-container-title">Note</p><p>如果跨域请求带cookie，那么<code>Access-Control-Allow-Origin</code>不能设置为<code>*</code>，这一点需要注意</p></div><h2 id="_2、性能-内存优化" tabindex="-1"><a class="header-anchor" href="#_2、性能-内存优化"><span>2、性能&amp;内存优化</span></a></h2><p><code>micro-app</code>支持两种渲染微前端的模式，默认模式和umd模式。</p><ul><li><strong>默认模式：</strong> 子应用在初次渲染和后续渲染时会顺序执行所有js，以保证多次渲染的一致性。</li><li><strong>umd模式：</strong> 子应用暴露出<code>mount</code>、<code>unmount</code>方法，此时只在初次渲染时执行所有js，后续渲染只会执行这两个方法，在多次渲染时具有更好的性能和内存表现。</li></ul><p><strong>我的项目是否需要切换为umd模式?</strong></p><p>如果子应用渲染和卸载不频繁，那么使用默认模式即可，如果子应用渲染和卸载非常频繁建议使用umd模式。</p><p><strong>切换为umd模式：子应用在window上注册mount和unmount方法</strong></p>`,12),m=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// index.js"),s(`
`),n("span",{class:"token keyword"},"import"),s(" React "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"react"'),s(`
`),n("span",{class:"token keyword"},"import"),s(" ReactDOM "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"react-dom"'),s(`
`),n("span",{class:"token keyword"},"import"),s(" App "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./App'"),s(`

`),n("span",{class:"token comment"},"// 👇 将渲染操作放入 mount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"mount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  ReactDOM`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"<"),s("App "),n("span",{class:"token operator"},"/"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getElementById"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"root"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 👇 将卸载操作放入 unmount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"unmount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  ReactDOM`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unmountComponentAtNode"),n("span",{class:"token punctuation"},"("),s("document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getElementById"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"root"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 微前端环境下，注册mount和unmount方法"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_ENVIRONMENT__"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  window`),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"micro-app-"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_NAME__"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" mount"),n("span",{class:"token punctuation"},","),s(" unmount "),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 非微前端环境直接渲染"),s(`
  `),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),v=n("p",null,[s("这里只介绍配合"),n("code",null,"vue-router3.x"),s("的用法")],-1),b=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// main.js"),s(`
`),n("span",{class:"token keyword"},"import"),s(" Vue "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'vue'"),s(`
`),n("span",{class:"token keyword"},"import"),s(" router "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./router'"),s(`
`),n("span",{class:"token keyword"},"import"),s(" App "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./App.vue'"),s(`

`),n("span",{class:"token keyword"},"let"),s(" app "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token comment"},"// 👇 将渲染操作放入 mount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"mount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Vue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    router`),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token function-variable function"},"render"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token parameter"},"h"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"h"),n("span",{class:"token punctuation"},"("),s("App"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"$mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#app'"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 👇 将卸载操作放入 unmount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"unmount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"$destroy"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  app`),n("span",{class:"token punctuation"},"."),s("$el"),n("span",{class:"token punctuation"},"."),s("innerHTML "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"''"),s(`
  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 微前端环境下，注册mount和unmount方法"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_ENVIRONMENT__"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  window`),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"micro-app-"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_NAME__"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" mount"),n("span",{class:"token punctuation"},","),s(" unmount "),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 非微前端环境直接渲染"),s(`
  `),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("p",null,[s("这里只介绍配合"),n("code",null,"vue-router4.x"),s("的用法")],-1),w=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// main.js"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" createApp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'vue'"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token keyword"},"as"),s(" VueRouter "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'vue-router'"),s(`
`),n("span",{class:"token keyword"},"import"),s(" routes "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./router'"),s(`
`),n("span",{class:"token keyword"},"import"),s(" App "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./App.vue'"),s(`

`),n("span",{class:"token keyword"},"let"),s(" app "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token keyword"},"let"),s(" router "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token keyword"},"let"),s(" history "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token comment"},"// 👇 将渲染操作放入 mount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"mount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  history `),n("span",{class:"token operator"},"="),s(" VueRouter"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"createWebHistory"),n("span",{class:"token punctuation"},"("),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_BASE_ROUTE__ "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token string"},"'/'"),n("span",{class:"token punctuation"},")"),s(`
  router `),n("span",{class:"token operator"},"="),s(" VueRouter"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"createRouter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    history`),n("span",{class:"token punctuation"},","),s(`
    routes`),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"createApp"),n("span",{class:"token punctuation"},"("),s("App"),n("span",{class:"token punctuation"},")"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),s("router"),n("span",{class:"token punctuation"},")"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#app'"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 👇 将卸载操作放入 unmount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"unmount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unmount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  history`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"destroy"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
  router `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
  history `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 微前端环境下，注册mount和unmount方法"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_ENVIRONMENT__"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  window`),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"micro-app-"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_NAME__"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" mount"),n("span",{class:"token punctuation"},","),s(" unmount "),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 非微前端环境直接渲染"),s(`
  `),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),y=n("p",null,[s("以"),n("code",null,"angular11"),s("为例。")],-1),f=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// main.ts"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" platformBrowserDynamic "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'@angular/platform-browser-dynamic'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" AppModule "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./app/app.module'"),n("span",{class:"token punctuation"},";"),s(`

declare global `),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"interface"),s(),n("span",{class:"token class-name"},"Window"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token literal-property property"},"microApp"),n("span",{class:"token operator"},":"),s(` any
    `),n("span",{class:"token literal-property property"},"__MICRO_APP_NAME__"),n("span",{class:"token operator"},":"),s(` string
    `),n("span",{class:"token literal-property property"},"__MICRO_APP_ENVIRONMENT__"),n("span",{class:"token operator"},":"),s(` string
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"let"),s(" app "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 👇 将渲染操作放入 mount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"mount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token function"},"platformBrowserDynamic"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bootstrapModule"),n("span",{class:"token punctuation"},"("),s("AppModule"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"catch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"err"),s(),n("span",{class:"token operator"},"=>"),s(" console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 👇 将卸载操作放入 unmount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"unmount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// angular在部分场景下执行destroy时会删除根元素app-root，此时可删除app.destroy()以避免这个问题"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"destroy"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 微前端环境下，注册mount和unmount方法"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_ENVIRONMENT__"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  window`),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"micro-app-"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_NAME__"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" mount"),n("span",{class:"token punctuation"},","),s(" unmount "),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 非微前端环境直接渲染"),s(`
  `),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),g=n("p",null,[s("因为vite作为子应用时关闭了沙箱，导致"),n("code",null,"__MICRO_APP_ENVIRONMENT__"),s("和"),n("code",null,"__MICRO_APP_NAME__"),s("两个变量失效，所以需要自行判断是否微前端环境以及手动填写应用name值。")],-1),h=n("p",null,"这里以 vue3 + vue-router4 为例：",-1),A=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// main.js"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" createApp "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'vue'"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token operator"},"*"),s(),n("span",{class:"token keyword"},"as"),s(" VueRouter "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'vue-router'"),s(`
`),n("span",{class:"token keyword"},"import"),s(" routes "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./router'"),s(`
`),n("span",{class:"token keyword"},"import"),s(" App "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'./App.vue'"),s(`

`),n("span",{class:"token keyword"},"let"),s(" app "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token keyword"},"let"),s(" router "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token keyword"},"let"),s(" history "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token comment"},"// 👇 将渲染操作放入 mount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"mount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  history `),n("span",{class:"token operator"},"="),s(" VueRouter"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"createWebHashHistory"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  router `),n("span",{class:"token operator"},"="),s(" VueRouter"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"createRouter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    history`),n("span",{class:"token punctuation"},","),s(`
    routes`),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`

  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"createApp"),n("span",{class:"token punctuation"},"("),s("App"),n("span",{class:"token punctuation"},")"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),s("router"),n("span",{class:"token punctuation"},")"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'#app'"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 👇 将卸载操作放入 unmount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"unmount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unmount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  history`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"destroy"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
  app `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
  router `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
  history `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 微前端环境下，注册mount和unmount方法"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("如果是微前端环境"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 应用的name值，即 <micro-app> 元素的name属性值"),s(`
  window`),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"micro-app-"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("应用的name值"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" mount"),n("span",{class:"token punctuation"},","),s(" unmount "),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 非微前端环境直接渲染"),s(`
  `),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),j=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js","data-title":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// entry.js"),s(`

`),n("span",{class:"token comment"},"// 👇 将渲染操作放入 mount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"mount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 👇 将卸载操作放入 unmount 函数 -- 必填"),s(`
`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"unmount"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token operator"},"..."),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"// 微前端环境下，注册mount和unmount方法"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_ENVIRONMENT__"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  window`),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"micro-app-"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("window"),n("span",{class:"token punctuation"},"."),s("__MICRO_APP_NAME__"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(" mount"),n("span",{class:"token punctuation"},","),s(" unmount "),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// 非微前端环境直接渲染"),s(`
  `),n("span",{class:"token function"},"mount"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=c(`<h4 id="自定义名称" tabindex="-1"><a class="header-anchor" href="#自定义名称"><span>自定义名称</span></a></h4><p>通常注册函数的形式为 <code>window[&#39;micro-app-\${window.__MICRO_APP_NAME__}&#39;] = {}</code>，但也支持自定义名称，<code>window[&#39;自定义的名称&#39;] = {}</code></p><p>自定义的值需要在<code>&lt;micro-app&gt;</code>标签中通过<code>library</code>属性指定。</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>micro-app</span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>xxx<span class="token punctuation">&#39;</span></span>
  <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>xxx<span class="token punctuation">&#39;</span></span>
  <span class="token attr-name">library</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>自定义的名称<span class="token punctuation">&#39;</span></span> <span class="token attr-name">👈</span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>micro-app</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),N={class:"custom-container note"},P=n("p",{class:"custom-container-title"},"Note",-1),R=n("li",null,"mount和unmount方法都是必须的",-1),x=n("li",null,"nextjs, nuxtjs等ssr框架作为子应用时暂不支持umd模式",-1),E=n("li",null,[s("因为注册了"),n("code",null,"unmount"),s("函数，所以卸载监听事件 "),n("code",null,"window.addEventListener('unmount', () => {})"),s(" 就不需要了")],-1),O={href:"https://github.com/micro-zoe/micro-app/issues/138",target:"_blank",rel:"noopener noreferrer"};function I(V,C){const e=o("TabPanel"),p=o("Tabs"),l=o("ExternalLinkIcon");return i(),r("div",null,[d,a(p,null,{default:t(()=>[a(e,{title:"React"},{default:t(()=>[m]),_:1}),a(e,{title:"Vue2"},{default:t(()=>[v,b]),_:1}),a(e,{title:"Vue3"},{default:t(()=>[_,w]),_:1}),a(e,{title:"Angular"},{default:t(()=>[y,f]),_:1}),a(e,{title:"Vite"},{default:t(()=>[g,h,A]),_:1}),a(e,{title:"其它"},{default:t(()=>[j]),_:1})]),_:1}),M,n("div",N,[P,n("ol",null,[R,x,E,n("li",null,[s("umd模式下，因为初次渲染和后续渲染逻辑不同，可能会出现一些问题，如："),n("a",O,[s("#138"),a(l)])])])])])}const $=u(k,[["render",I],["__file","advanced.html.vue"]]);export{$ as default};
